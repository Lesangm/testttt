# 재배포 절차

1. IntelliJ 프로젝트 디렉토리 → 'target' 디렉토리를 완전히 삭제한다.
2. IntelliJ 우측 Maven 메뉴 → 'Liftcycle' → 'package'를 실행한다.
3. 위 <2> 절차가 정상적으로 완료될 경우 다시 <1>의 'target' 디렉토리가 생성되는데, 해당 디렉토리 아래에 'war'파일이 배포시에 사용됨으로 복사하여 알기쉬운 위치로 붙여넣은 뒤 이름을 `ROOT.war`로 수정한다.
4. GCP Compute Engine SSH에 접속한다.
5. 현재 Tomcat 서비스가 실행 중이라면 아래 명령어를 입력하여 중지시킨다.
   > ```
   > sudo service tomcat9 stop 
   > ```
6. <3>에서 준비한 WAR 파일을 사용자 디렉토리로 업로드하기 위해 아래 명령어를 통해 사용자 디렉토리로 이동한다.
   > ```
   > cd ~
   > ```
7. 파일을 업로드 하고, 아래 명령어를 통해 정상적으로 업로드 되었는지 확인한다.
   > ```
   > ls -l
   > ```
   > ```
   > total 22356
   > -rw-rw-r-- 1 user user 22891172 Aug  8 10:31 ROOT.war
   > ```
8. 기존의 포트폴리오(혹은 프로젝트) `war`파일을 삭제하기 위해 아래 명령어를 입력하여 작업 중인 디렉토리를 이동한다.
   > 만약, 포트폴리오를 변경하는 상황이라면, `webapps` 디렉토리로 이동해야 함으로 아래 명령어를 이용한다.
   > ```
   > cd /var/lib/tomcat9/webapps/
   > ```
   > 만약, 프로젝트를 변경하는 상황이라면, 팀에서 협의한 디렉토리로 이동해야 함으로 아래 명령어를 적절히 참고한다.
   > ```
   > cd /var/lib/tomcat9/moviesq/
   > ``` 
9. 기존의 포트폴리오(혹은 프로젝트)와 관련된 모든 파일 및 디렉토리를 삭제하기 위해 아래와 같이 명령한다. 단, 아래 명령어는 현재 작업 위치 및 이하 모든 파일 및 디렉토리를 삭제하는 명령어 임으로 반드시 <8>의 명령이 정상적으로 작동했는지 확인해야 한다.
   > ```
   > sudo rm -rf *
   > ```
10. <7>에서 준비한 파일을 Tomcat 디렉토리로 옮겨 오기 위해 아래와 같이 명령한다.
   > ```
   > sudo mv ~/ROOT.war ./
   > ```
   > 마찬가지로, 아래 명령어를 통해 파일이 정상적으로 옮겨졌는지 확인한다.
   > ```
   > ls -l
   > ```
   > 파일이 정상적으로 옮겨졌다면, 아래 명령어를 통해 `war`파일의 소유주와 소유그룹을 `tomcat`으로 이관한다.
   > ```
   > sudo chown -R tomcat:tomcat ROOT.war
   > ``` 
11. 그 후, 아래 명령을 통해 Tomcat 서비스를 재시작한다.
   > ```
   > sudo service tomcat9 start
   > ```
   > 1분 가량 후, 아래 명령어를 통해 `80`번 포트에 대해 `LISTEN`중인 소켓이 있는지 확인한다.
   > ```
   > sudo netstat -nltp
   > ``` 
12. DNS에 연결되어 있는 도메인에 접속하여 정상 접속되는지 확인한다.

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>